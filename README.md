# UtilTelegBot

Telegram бот для предоставления шаблонов государственных заявлений. Пользователи могут выбрать кампанию, выбрать государственный орган и получить шаблоны заявлений в виде текста или файла.

## Особенности

- Интерактивный интерфейс Telegram бота
- Настраиваемые кампании и государственные органы
- Доставка шаблонов в виде текста или файла
- Отслеживание статистики использования
- Конфигурация на основе YAML
- Конфигурация логирования Logback

## Структура проекта

```
src/
├── main/
│   ├── java/
│   │   └── com/utilteleg/bot/
│   │       ├── model/           # Модели данных (Campaign, Agency)
│   │       ├── service/         # Бизнес-логика (StatisticsService)
│   │       ├── config/          # Классы конфигурации
│   │       ├── Application.java # Основной класс приложения
│   │       ├── TelegramBotConfig.java # Конфигурация Telegram бота
│   │       └── TelegramBotService.java # Реализация Telegram бота
│   └── resources/
│       ├── templates/           # Файлы шаблонов для каждого органа
│       │   ├── fns/
│       │   ├── local-tax/
│       │   └── social/
│       ├── data/                # Файлы данных (статистика)
│       ├── application.yml      # Конфигурация приложения
│       └── logback.xml          # Конфигурация логирования
└── test/                        # Модульные тесты (для реализации)
```

## Конфигурация

Бот настраивается через `application.yml`:

```yaml
telegram:
  bot:
    username: ${TELEGRAM_BOT_USERNAME:YourBotUsername}
    token: ${TELEGRAM_BOT_TOKEN:YourBotToken}

campaigns:
  - id: campaign1
    name: "Кампания по декларации налогов"
    description: "Помощь в процессе подачи налоговой декларации"
    agencies:
      - id: agency1
        name: "Федеральная налоговая служба"
        description: "Федеральная налоговая служба России"
        template-file: "templates/fns/template.txt"
        delivery-options:
          - "file"
          - "text"

statistics:
  file-path: "data/statistics.json"
```

## Статистика использования

Бот отслеживает загрузки шаблонов в файле JSON (`data/statistics.json`) для сохранения статистики между перезапусками приложения.

## Логирование

Логирование настраивается через `logback.xml` с выводом как в консоль, так и в файл.

## Как запустить

1. Настройте учетные данные вашего Telegram бота в переменных окружения:
   - `TELEGRAM_BOT_USERNAME`
   - `TELEGRAM_BOT_TOKEN`

2. Соберите проект:
   ```bash
   mvn clean package
   ```

3. Запустите приложение:
   ```bash
   java -jar target/util-teleg-bot-1.0-SNAPSHOT.jar
   ```

## Команды Telegram бота

- `/start` - Приветственное сообщение
- `/campaigns` - Список доступных кампаний

## Детали реализации

Приложение использует Spring Boot для внедрения зависимостей и управления конфигурацией. Telegram бот реализован с использованием библиотеки Telegram Bots API.

Основные компоненты:
- `TelegramBotService` - Обрабатывает все взаимодействия с Telegram
- `StatisticsService` - Управляет статистикой загрузок шаблонов
- `AppConfig` - Загружает конфигурацию кампаний и органов из YAML
- Файлы шаблонов хранятся в каталоге ресурсов и могут быть легко изменены

Рабочий процесс бота:
1. Пользователь запускает бота с помощью `/start`
2. Пользователь запрашивает кампании с помощью `/campaigns`
3. Пользователь выбирает кампанию по номеру
4. Пользователь выбирает орган по номеру
5. Пользователь выбирает метод доставки (файл или текст)
6. Бот отправляет соответствующий шаблон
7. Статистика загрузок обновляется